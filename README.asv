# BO-PBK

**Version 1.0** | [GitHub Repository](https://github.com/baiweiphys/BOPBK/)

**BO-PBK** (BO-Product-Bi-Kappa) is a numerical code developed by **Wei Bai** and **Huasheng Xie** for analyzing plasma waves and instabilities in both space and laboratory plasmas. The code specializes in obliquely propagating waves in magnetized, multi-species hot plasmas.

The code supports a wide range of multi-component velocity distribution functions, such as:
- Anisotropic drift loss-cone product-bi-Kappa (PBK)
- Anisotropic drift loss-cone Kappa-Maxwellian (KM)
- Anisotropic drift loss-cone bi-Maxwellian (BM)
- Hybrid combinations of these distributions

## Authors & Affiliations

**Wei Bai**  
College of Electrical and Power Engineering  
Taiyuan University of Technology  
Taiyuan 030024, China  
Email: baiweiphys@gmail.com, baiwei12@mail.ustc.edu.cn

**Huasheng Xie**  
ENN Science and Technology Development Co., Ltd.  
Hebei Key Laboratory of Compact Fusion  
Langfang 065001, China  
Email: huashengxie@gmail.com, xiehuasheng@enn.cn

## Release Date
2025-12-08

## Program Description

**BO-PBK** is a comprehensive code for simultaneously solving all significant roots of the dispersion relation for obliquely propagating waves in magnetized multi-species plasmas.

The code supports various velocity distribution functions, including:
- Anisotropic drift loss-cone product-bi-Kappa (PBK)
- Anisotropic drift loss-cone kappa-Maxwellian (KM)
- Anisotropic drift loss-cone bi-Maxwellian (BM)
- Hybrid combinations of these distributions

Benchmark tests confirm that the solver accurately reproduces standard kinetic results and efficiently resolves waves and instabilities. 
BO-PBK provides a robust and computationally efficient tool for wave and stability analysis in complex plasma systems relevant to both space and laboratory applications.

## Input Parameters

The background magnetic field is denoted as $B_0$ (in Tesla), the oblique propagation angle as $\theta$ (in degrees), $J$ as a non-negative integer for $J$-pole expansion, and `nk` as the number of grid points.

The `bopbk.in` file requires the following parameters for each species $s$:
- $q_s$: charge (in elementary charge units)
- $m_s$: mass (relative to electron mass)
- $n_s$: number density (in m⁻³)
- $T_{\parallel s}$ and $T_{\perp s}$: parallel and perpendicular temperatures (in eV)
- $u_{s0}/c$: drift velocity (normalized by speed of light)
- $\sigma_s$: loss-cone factor
- $\kappa_{\parallel s}$ and $\kappa_{\perp s}$: parallel and perpendicular kappa indices
- $\kappa_{\parallel s,\text{th}}$: threshold value for $\kappa_{\parallel s}$
- $N_s$: Bessel function truncation order for species $s$

## Benchmark Examples

Seven benchmark cases are provided as representative examples:
1. R-, L-, and P-mode waves
2. Whistler instability
3. Firehose instability
4. EMIC waves

## System Requirements

Currently, only a MATLAB version of **BO-PBK** is available. The code has been successfully tested on:
- macOS 15 and Windows 11 with MATLAB 2024a
- Ubuntu 22.04 LTS with MATLAB 2024a



## File Descriptions


### Example Cases
- **`examples/Case_XXX/`** - Individual test case directories containing specific configuration files.
  - **`main_bopbk.m`** - Primary driver routine that initiates the simulation with user-defined parameters.
  - **`output/`** - Directory for storing simulation outputs, including dispersion relations and growth rates.
  - (Optional module) **`selected_plot/`** - Contains enhanced visualization routines for 2D/3D plots (based on Xie 2019, CPC).

### Core Source Code
- **`src/`** - Directory containing the core numerical routines and functions.
  - **`solver_pbk.m`** - Numerical solver for plasmas described by PBK distributions.
  - **`solver_maxwell.m`** - Solver for BM plasma models.
  - **`solver_mixed.m`** - Solver for hybrid plasma models combining PBK, KM, and BM distributions.
  - **`func_Jpole.m`** - Implements the J-pole expansion technique for efficient evaluation of plasma dispersion functions.
  - **`getIndexOfBlkMatrix_*.m`** - Functions for extracting indices of sub-block matrices in the global dispersion matrix of PBK, BM, and their mixed.
  - **`maxwell_*.m`** - Coefficient calculation routines for the oblique BM plasma model.
  - **`pbk_*.m`** - Coefficient calculation routines for the oblique PBK plasma model.
  - **`M_*.m`** - Functions that construct equivalent matrices for PBK, BM, and mixed distribution models.
  - **`getLen_*.m`** - Utility functions for determining matrix dimensions and sizes.

### Utility Functions
- **`tools/`** - Directory containing auxiliary utility functions.
  - **`createDateFile.m`** - Creates a new timestamped data folder if the specified directory does not exist, ensuring organized data storage.


## How to run the code:

1. **Run a single test case**:
   - Navigate to the specific case directory: `BO-PBK/examples/case_XXXX/`
   - Configure the input parameters in the input file `bopbk.in`
   - Set parameters such as `J`, `deg` (propagation angles in degrees), and `B0` (background magnetic field in z-direction)
   - Run the main script `main_bopbk.m`
   - Results will be displayed as plots and saved in the `output` directory
2. **Visualize and save data**: (Xie 2019, CPC)
   - Navigate to `selected_plot/`
   - Configure `bo_wpdat.m` and run it to generate figures and save data as `*.dat` files.

3. Show the benchmark cases
   - **Example 1:**
    - 1. Run `case02.1_whistler/main_bopbk`
  Then run `./selected-plot/bo_wpdat`
    - 2. Copy `*.dat` files to `../../plt_Fig4/BOPBK_data`
    - 3. Repeat the above steps for `Whistler_Lazar11Fig2_pbk2/` and `Whistler_Lazar11Fig2_pbk6/`. After running each, copy the corresponding `./selected-plot/*.dat` files to `plt_Fig4/BOPBK_data`
    - 4. Run `/plt_Fig4/plt_benchmark_lazar2011Fig2.m`
  
   - **Example 2:**
    - 1. Run `case03.1_firehose/Astfalk2017Fig1_OFHI3d_bm/main_bopbk.m`
    - 2. Copy `/output/*.dat` files to `../../plt_Fig8/pbk_data`
    - 3. Repeat the above steps for `Astfalk2017Fig1_OFHI3d_pbk210main_bopbk.m/`. After running it, copy the corresponding `output/*.dat` files to `plt_Fig8/pbk_data`
    - 4. Run `/plt_Fig8/plt_Astfalk2017fig1_contour2.m`

4. **Customization**: To customize plots, modify the plotting section in `main_bopbk.m` or create your own plotting scripts.


## License

This project is licensed under the BSD 3-Clause License - see the [LICENSE](LICENSE) file for details.




If you encounter any issues, kindly get in touch with us.

Wei Bai, baiweiphys@gmail.com, baiwei12@mail.ustc.edu.cn, TYUT

Huasheng Xie,  huashengxie@gmail.com, xiehuasheng@enn.cn, ENN


Created by Wei Bai on 2024-07-24  
Updated by Wei Bai on 2025-12-08


